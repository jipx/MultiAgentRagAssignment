# ğŸ« School of Computing (SoC)

## ğŸ§ª Secure Coding â€“ Practical 6  
**Topic:** Secure Code Against **Cross-Site Scripting (XSS)** and **SQL Injection (SQLi)**

---

## ğŸ” Securing Revision Practical Code

1. ğŸ“¥ **Download** the source codes for Practical 6 and **unzip** the files.

2. ğŸ“‚ **Download** the SQL script and **run it in MySQL**.

3. âš™ï¸ **Update** your `databaseConfig.js` file with the correct database login credentials **if necessary**.

4. ğŸ’» **Run the following commands** in both the `firstExpressServer` and `firstFrontEnd` directories:

    ```bash
    npm install
    node server.js
    ```

5. ğŸŒ **Navigate to:**

    ```
    http://localhost:3001/viewUsers.html
    ```

6. ğŸ§ª **Stored XSS Attack:**

    - Inject an alert script into the database.
    - The alert should **pop up** when you are redirected to `viewUsers.html`.

7. âš ï¸ **SQL Injection Vulnerability:**

    - The page `viewUsers.html` is **vulnerable to SQL injection**.
    - Try injecting SQL to retrieve data from other tables.

---

## ğŸ§° Remediation Steps â€“ Securing Web Services API

To mitigate these issues, youâ€™ll secure the backend API with:

- âœ… Proper **input validation**
- âœ… Output **sanitization**

---

## ğŸ“ Create a New Directory: `validation/`

Inside `FirstBackEnd`, create a new folder called `validation`.

Then create a new file:

```
validationFn.js
```

This file will contain middleware functions.

---

## ğŸ“„ `validationFn.js` Content

### A) âœï¸ `validateRegister` Middleware Function

Validates input from the client (username, email, password).  
Returns **status 500** if validation fails.

**Rules:**

- âœ… **Username**: alphabets, spaces, `'` and `,` only.
- âœ… **Email**: must be valid (regex check).
- âœ… **Password**: 
  - At least one uppercase
  - At least one lowercase
  - At least one number
  - At least 8 characters

---

### B) ğŸ”¢ `validateUserid` Middleware Function

Checks that `userid` is a valid number.  
Returns **status 500** if validation fails.

---

### C) ğŸ§¼ `sanitizeResult` Function

Sanitizes **string values** in the result array from MySQL query.  
This ensures output data sent back to the frontend is **clean and safe**.

---

## ğŸ§© Apply Middleware in `app.js`

Update `app.js`:

- Use `validateRegister` and `validateUserid` middleware in appropriate API endpoints.
- Apply `sanitizeResult` to **GET /user** and **GET /user/:userid** responses.

---

## ğŸ›¡ï¸ Fixing SQL Injection in `user.js`

Update your query logic to use parameterized queries or escape inputs properly.

---

## âœ… Final Test

1. Run the app.
2. Register users and query users.
3. Confirm:
   - No alert boxes are triggered.
   - No SQL injections succeed.
   - Input errors are handled gracefully.
