
# ğŸ§ª Auto-Split & Ingest Lab Assistant using Amazon Bedrock

## ğŸ¯ Project Goal

Enable educators to upload a full lab PDF and automatically:

- ğŸ” Extract each step (e.g., "Step 1", "Step 2")
- ğŸ·ï¸ Attach metadata (`lab_id`, `step_number`)
- â˜ï¸ Upload and ingest to Amazon Bedrock Knowledge Base (KB)
- ğŸ§‘â€ğŸ“ Allow students to:
  - View lab steps
  - Ask questions per step
  - Receive AI-generated hints and step-by-step answers

---

## ğŸ—ï¸ Architecture Overview

```mermaid
flowchart TD
    A[Educator uploads lab PDF to S3]
    A --> B[Lambda (Auto Split)]
    B --> C[Extract Steps from PDF]
    C --> D[Upload steps to S3 as .txt]
    D --> E[Ingest into Bedrock KB with metadata]
    F[Student on Streamlit UI]
    F --> G[Select lab & step]
    G --> H[Ask Question or Request Hint]
    H --> I[Claude 3 + Bedrock KB]
    I --> J[Answer/Hint returned]
```

---

## âœ… Features

| Feature                                      | Status |
|----------------------------------------------|--------|
| Upload full lab as PDF                       | âœ…     |
| Auto-split by `Step N:`                      | âœ…     |
| Attach `lab_id` and `step_number` metadata   | âœ…     |
| Upload split steps to S3                     | âœ…     |
| Ingest into Amazon Bedrock Knowledge Base    | âœ…     |
| Claude 3 RAG: per-step hint & answer         | âœ…     |
| Streamlit UI for viewing, Q&A, hinting       | âœ…     |

---

## ğŸ§© Components

### 1. Lambda Function (Triggered by S3)
- Extracts text using `pdfplumber`
- Splits content into steps using regex
- Uploads `.txt` per step to S3
- Ingests each step to Bedrock KB with metadata

### 2. Amazon Bedrock
- Claude 3 Sonnet for generation
- Titan Embeddings + Knowledge Base
- Filters per `lab_id` and `step_number`

### 3. Streamlit UI
- Tabbed interface:
  - ğŸ“˜ View Lab
  - ğŸ§  Ask Assistant
  - ğŸ’¡ Generate Hint
- Uses Bedrock API for RAG answers

---

## ğŸ› ï¸ Tech Stack

- **AWS Lambda** â€“ automation logic
- **Amazon S3** â€“ storage for raw and split files
- **Amazon Bedrock** â€“ Claude 3 + Titan Embeddings
- **Streamlit** â€“ student frontend
- **pdfplumber** â€“ PDF parsing

---

## âœ… Workflow

1. Educator uploads `labs/lab3/lab3_lab.pdf`
2. Lambda:
   - Extracts "Step 1" to "Step N"
   - Uploads as `labs/lab3/step1.txt`, etc.
   - Ingests each with metadata into Bedrock KB
3. Student:
   - Selects lab and step in Streamlit
   - Asks question
   - Gets hint and answer from Claude 3 via Bedrock RAG

---

## ğŸ”œ Optional Extensions

- âœ… Upload UI in Streamlit
- ğŸŸ¡ Quiz per step
- ğŸŸ¡ Cognito login
- ğŸŸ¡ DynamoDB history
- ğŸŸ¡ Auto-index entire lab folder

---

## ğŸ“ Example S3 Layout

```
labs/
â”œâ”€â”€ lab3/
â”‚   â”œâ”€â”€ lab3_lab.pdf              â† uploaded
â”‚   â”œâ”€â”€ step1.txt                 â† auto-generated
â”‚   â”œâ”€â”€ step2.txt
â”‚   â””â”€â”€ step3.txt
```

---

## ğŸ” Required IAM Permissions

```json
{
  "Action": [
    "s3:GetObject",
    "s3:PutObject",
    "bedrock:PutKnowledgeBaseDataSourceDocuments"
  ],
  "Effect": "Allow",
  "Resource": "*"
}
```

---

## ğŸ“„ Prompt Template (Claude)

```text
Lab Title: {lab_title}
Context:
{retrieved_docs}

Student Question:
{user_question}

Hint: <auto-generated tip>
Answer: <step-by-step explanation>
```

---

## ğŸ“¦ Deploy Options

- [ ] Streamlit uploader tab
- [ ] GitHub Actions for ingest automation
- [ ] CDK/SAM for infrastructure

---

## ğŸ™‹ Need Help?

Open an issue or request a feature. You can also request:
- Deployment template (SAM/CDK)
- Streamlit + Lambda ZIPs
- Quiz integration support

---

## ğŸ§  Claude 3 Prompt Template (Lab Assistant)

```jinja
You are an intelligent lab teaching assistant designed to help students understand technical lab steps.

## Lab Information:
- Lab ID: {{ lab_id }}
- Step Number: {{ step_number }}
- Title: {{ lab_title }}

## Context from the Lab Step:
{{ retrieved_context }}

---

## Student Input:
{{ user_question }}

---

## Instructions:
1. Use only the above lab context and the student's question to generate your response.
2. If the question is unclear or incomplete, ask a clarifying question.
3. If the answer is not in the retrieved context, say:
   - "The provided lab instructions do not explicitly cover this."
   - Offer a general suggestion based on typical best practices.
4. If the user asked for a **hint**, provide a gentle nudge without giving away the full solution.

---

## Output Format:
### âœ… Hint (if applicable):
{{ hint }}

### âœ… Answer:
{{ full_answer }}
```

---

## ğŸ§  Lab Agent Code (Claude 3 + Amazon Bedrock)

```python
import boto3
import os

bedrock = boto3.client("bedrock-agent-runtime", region_name="us-east-1")

def generate_lab_answer(user_question, lab_id, step_number, lab_title):
    prompt_template = f"""
You are an intelligent lab teaching assistant designed to help students understand technical lab steps.

## Lab Information:
- Lab ID: {lab_id}
- Step Number: {step_number}
- Title: {lab_title}

## Context from the Lab Step:
{{{{retrieved_context}}}}

---

## Student Input:
{user_question}

---

## Instructions:
1. Use only the above lab context and the student's question to generate your response.
2. If the question is unclear or incomplete, ask a clarifying question.
3. If the answer is not in the retrieved context, say:
   - "The provided lab instructions do not explicitly cover this."
   - Offer a general suggestion based on typical best practices.
4. If the user asked for a **hint**, provide a gentle nudge without giving away the full solution.

---

## Output Format:
### âœ… Hint (if applicable):
{{{{hint}}}}

### âœ… Answer:
{{{{full_answer}}}}
"""

    response = bedrock.retrieve_and_generate(
        input={"text": user_question},
        retrieveAndGenerateConfiguration={
            "type": "KNOWLEDGE_BASE",
            "knowledgeBaseConfiguration": {
                "knowledgeBaseId": os.environ["KB_ID"],
                "modelArn": os.environ["MODEL_ARN"],
                "retrievalConfiguration": {
                    "vectorSearchConfiguration": {
                        "numberOfResults": 5,
                        "filter": {
                            "andAll": [
                                {"equals": {"key": "lab_id", "value": lab_id}},
                                {"equals": {"key": "step_number", "value": str(step_number)}}
                            ]
                        }
                    }
                },
                "generationConfiguration": {
                    "promptTemplate": {
                        "textPromptTemplate": prompt_template
                    }
                }
            }
        }
    )

    return response["output"]["text"]
```
